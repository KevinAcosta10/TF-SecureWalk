<div class="main-container">
  <div class="form-card-container">
    <h1 class="form-title">{{ edicion ? 'Editar Respuesta' : 'Registrar Nueva Respuesta' }}</h1>

    <form [formGroup]="form" (submit)="aceptar()" class="respuesta-form">
      <mat-form-field appearance="outline" class="full-width-field">
        <mat-label>Fecha de Respuesta</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="fechaRespuesta" />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="form.get('fechaRespuesta')?.hasError('required')">
          La fecha de respuesta es obligatoria.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width-field">
        <mat-label>Texto de Respuesta</mat-label>
        <textarea matInput formControlName="textoRespuesta" rows="4"></textarea>
        <mat-icon matSuffix>text_fields</mat-icon>
        <mat-error *ngIf="form.get('textoRespuesta')?.hasError('required')">
          El texto de respuesta es obligatorio.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width-field">
        <mat-label>Usuario</mat-label>
        <mat-select formControlName="usuario">
          <mat-option [value]="null" disabled>Seleccione un usuario</mat-option>
          @for (u of listaUsuarios; track u.idUsuario) {
          <mat-option [value]="u">
            {{ u.nombreUsuario }} ({{ u.emailUsuario }})
          </mat-option>
          }
        </mat-select>
        <mat-icon matSuffix>person</mat-icon>
        <mat-error *ngIf="form.get('usuario')?.hasError('required')">
          El usuario es obligatorio.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width-field">
        <mat-label>Encuesta y Pregunta</mat-label>
        <mat-select formControlName="encuestaPregunta">
          <mat-option [value]="null" disabled>Seleccione una encuesta y pregunta</mat-option>
          @for (ep of listaEncuestaPregunta; track ep.idEncuestaPregunta) {
          <mat-option [value]="ep">
            Encuesta: {{ ep.encuesta.nombreEncuesta || 'N/A' }} - Pregunta: {{ ep.pregunta.textoPregunta || 'N/A' }}
          </mat-option>
          }
        </mat-select>
        <mat-icon matSuffix>assignment</mat-icon>
        <mat-error *ngIf="form.get('encuestaPregunta')?.hasError('required')">
          La encuesta y pregunta son obligatorias.
        </mat-error>
      </mat-form-field>

      <div class="form-actions">
        <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
          Aceptar
        </button>
        <button mat-raised-button color="warn" (click)="cancelar()" type="button">
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>